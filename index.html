<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>KIARA 4U - Vinyl Player</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #667eea, #764ba2);
    transition: background 1.5s ease;
    overflow: hidden;
    --neon-color: #ff00ff;
}

/* Hide FastCast default elements */
.cc_streaminfo, 
.cc_streaminfo_container, 
[class*="cc_"] {
    display: none !important;
    visibility: hidden !important;
    position: absolute !important;
    left: -9999px !important;
}

.player-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}

/* Vinyl Player Base */
.vinyl-player {
    position: relative;
    width: 340px;
    height: 340px;
    background: linear-gradient(145deg, #2a2a3a, #1a1a2a);
    border-radius: 20px;
    box-shadow: 
        0 25px 60px rgba(0,0,0,0.5),
        inset 0 1px 1px rgba(255,255,255,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Outer Glow Ring */
.outer-glow {
    position: absolute;
    width: 290px;
    height: 290px;
    border-radius: 50%;
    border: 2px solid var(--neon-color);
    opacity: 0.4;
    animation: outerPulse 3s ease-in-out infinite;
    pointer-events: none;
}

@keyframes outerPulse {
    0%, 100% { transform: scale(1); opacity: 0.4; }
    50% { transform: scale(1.06); opacity: 0.15; }
}

/* Vinyl Disc - LEBIH TIPIS */
.vinyl-disc {
    position: relative;
    width: 270px;
    height: 270px;
    border-radius: 50%;
    background: 
        repeating-radial-gradient(
            circle at center,
            #0a0a0a 0px, #0a0a0a 1px,
            #151515 1px, #151515 2px,
            #0a0a0a 2px, #0a0a0a 3px,
            #1a1a1a 3px, #1a1a1a 4px
        );
    box-shadow: 
        0 0 0 4px #080808,
        0 0 0 6px #2a2a2a,
        0 15px 40px rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
}

.vinyl-disc::before {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: linear-gradient(
        135deg,
        transparent 0%,
        rgba(255,255,255,0.06) 45%,
        rgba(255,255,255,0.1) 50%,
        rgba(255,255,255,0.06) 55%,
        transparent 100%
    );
    pointer-events: none;
}

.vinyl-disc.spinning {
    animation: spin 3.5s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Cover Container - LEBIH BESAR */
.cover-container {
    position: relative;
    width: 200px;
    height: 200px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 5;
}

/* Neon Glow Effect - LEBIH BESAR */
.neon-glow {
    position: absolute;
    width: 215px;
    height: 215px;
    border-radius: 50%;
    background: conic-gradient(
        var(--neon-color),
        #00ffff,
        #00ff99,
        #ff00ff,
        var(--neon-color)
    );
    animation: rotateGlow 4s linear infinite, pulseGlow 2s ease-in-out infinite alternate;
    filter: blur(10px);
    opacity: 0.7;
    z-index: 1;
}

@keyframes rotateGlow {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

@keyframes pulseGlow {
    from { opacity: 0.5; transform: scale(1); }
    to { opacity: 0.9; transform: scale(1.05); }
}

/* Cover Art - LEBIH BESAR */
.cover-art {
    width: 190px;
    height: 190px;
    border-radius: 50%;
    object-fit: cover;
    z-index: 2;
    box-shadow: 0 0 25px rgba(0,0,0,0.8);
    transition: opacity 0.5s ease;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
}

/* Center Hole - LEBIH KECIL */
.center-hole {
    position: absolute;
    width: 12px;
    height: 12px;
    background: radial-gradient(circle, #555 0%, #222 60%, #111 100%);
    border-radius: 50%;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.9);
    z-index: 10;
}

/* Tone Arm */
.tone-arm {
    position: absolute;
    top: 20px;
    right: 15px;
    width: 100px;
    height: 16px;
    transform-origin: right center;
    transform: rotate(-40deg);
    transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    z-index: 20;
}

.tone-arm.playing {
    transform: rotate(-12deg);
}

.tone-arm-base {
    position: absolute;
    right: -10px;
    top: -12px;
    width: 38px;
    height: 38px;
    background: radial-gradient(circle at 35% 35%, #666 0%, #333 50%, #1a1a1a 100%);
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0,0,0,0.6);
}

.tone-arm-base::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background: radial-gradient(circle, #888 0%, #444 100%);
    border-radius: 50%;
}

.tone-arm-bar {
    position: absolute;
    right: 6px;
    top: 4px;
    width: 82px;
    height: 7px;
    background: linear-gradient(to bottom, #888 0%, #555 50%, #333 100%);
    border-radius: 3px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.4);
}

.tone-arm-head {
    position: absolute;
    left: -5px;
    top: 1px;
    width: 16px;
    height: 12px;
    background: linear-gradient(to bottom, #666 0%, #333 100%);
    border-radius: 2px;
    transform: rotate(-18deg);
}

.tone-arm-needle {
    position: absolute;
    left: -10px;
    top: 9px;
    width: 8px;
    height: 2px;
    background: linear-gradient(to left, #ddd, #777);
    transform: rotate(-18deg);
}

/* Station Info */
.station-info {
    margin-top: 25px;
    text-align: center;
    color: #fff;
    width: 100%;
    max-width: 340px;
}

.station-name {
    font-size: 1.8em;
    font-weight: 700;
    background: linear-gradient(135deg, #fff 0%, var(--neon-color) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(0 0 15px var(--neon-color));
    margin-bottom: 6px;
    letter-spacing: 2px;
}

.now-playing {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    margin-bottom: 10px;
}

.now-playing-label {
    font-size: 0.65em;
    color: rgba(255,255,255,0.01);
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* Equalizer */
.equalizer {
    display: flex;
    gap: 3px;
    align-items: flex-end;
    height: 18px;
    opacity: 0;
    transition: opacity 0.3s;
}

.equalizer.active {
    opacity: 1;
}

.eq-bar {
    width: 3px;
    height: 4px;
    background: linear-gradient(to top, var(--neon-color), #fff);
    border-radius: 2px;
}

.equalizer.active .eq-bar {
    animation: eq 0.5s ease infinite;
}

.equalizer.active .eq-bar:nth-child(1) { animation-delay: 0s; }
.equalizer.active .eq-bar:nth-child(2) { animation-delay: 0.1s; }
.equalizer.active .eq-bar:nth-child(3) { animation-delay: 0.2s; }
.equalizer.active .eq-bar:nth-child(4) { animation-delay: 0.15s; }
.equalizer.active .eq-bar:nth-child(5) { animation-delay: 0.25s; }

@keyframes eq {
    0%, 100% { height: 4px; }
    50% { height: 18px; }
}

/* Song Info Box */
.song-info {
    background: rgba(0,0,0,0.3);
    padding: 12px 20px;
    border-radius: 20px;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}

.song-title {
    font-size: 1em;
    font-weight: 600;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 280px;
    margin-bottom: 3px;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.song-artist {
    font-size: 0.8em;
    color: rgba(255,255,255,0.8);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 280px;
    opacity: 0;
    transition: opacity 0.5s ease;
}

.song-title.fade-in,
.song-artist.fade-in {
    opacity: 1;
}

/* Controls */
.controls {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 20px;
}

.volume-control {
    display: flex;
    align-items: center;
    gap: 6px;
}

.volume-icon {
    width: 20px;
    height: 20px;
    fill: rgba(255,255,255,0.6);
}

.volume-slider {
    -webkit-appearance: none;
    width: 70px;
    height: 4px;
    border-radius: 2px;
    background: rgba(255,255,255,0.2);
}

.volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--neon-color);
    cursor: pointer;
    box-shadow: 0 0 10px var(--neon-color);
}

.volume-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: var(--neon-color);
    cursor: pointer;
    border: none;
}

.play-btn {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    border: none;
    background: linear-gradient(145deg, var(--neon-color), #7700aa);
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    box-shadow: 
        0 6px 25px rgba(255,0,255,0.5),
        0 0 40px rgba(255,0,255,0.2);
    transition: all 0.3s;
}

.play-btn:hover {
    transform: scale(1.1);
}

.play-btn:active {
    transform: scale(0.95);
}

.play-btn svg {
    width: 26px;
    height: 26px;
    fill: #fff;
}

.play-btn .pause-icon {
    display: none;
}

.play-btn.playing .play-icon {
    display: none;
}

.play-btn.playing .pause-icon {
    display: block;
}

/* Status */
.status {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 15px;
    font-size: 0.75em;
    color: rgba(255,255,255,0.6);
}

.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #444;
    transition: all 0.3s;
}

.status-dot.live {
    background: #00ff88;
    box-shadow: 0 0 12px #00ff88;
    animation: blink 1.5s ease infinite;
}

.status-dot.buffering {
    background: #ffaa00;
    box-shadow: 0 0 10px #ffaa00;
    animation: blink 0.4s ease infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
}

/* Background Particles */
.particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: -1;
    overflow: hidden;
}

.particle {
    position: absolute;
    background: rgba(255,255,255,0.6);
    border-radius: 50%;
    animation: floatUp 15s linear infinite;
}

@keyframes floatUp {
    0% {
        transform: translateY(100vh) scale(0);
        opacity: 0;
    }
    10% { opacity: 0.8; }
    90% { opacity: 0.6; }
    100% {
        transform: translateY(-100vh) scale(1);
        opacity: 0;
    }
}

/* Credit */
.credit {
    position: fixed;
    bottom: 8px;
    right: 10px;
    font-size: 11px;
    color: rgba(255,255,255,0.5);
}

/* Responsive */
@media (max-width: 400px) {
    .vinyl-player {
        width: 300px;
        height: 300px;
    }
    .vinyl-disc {
        width: 240px;
        height: 240px;
    }
    .cover-container {
        width: 175px;
        height: 175px;
    }
    .neon-glow {
        width: 188px;
        height: 188px;
    }
    .cover-art {
        width: 165px;
        height: 165px;
    }
    .outer-glow {
        width: 255px;
        height: 255px;
    }
    .station-name {
        font-size: 1.5em;
    }
    .song-title, .song-artist {
        max-width: 240px;
    }
    .play-btn {
        width: 58px;
        height: 58px;
    }
}
</style>
</head>

<body>

<div class="particles" id="particles"></div>

<span class="cc_streaminfo" data-type="song" data-username="kiarafm" id="fcast"></span>
<script src="https://eu1.fastcast4u.com/system/streaminfo.js"></script>

<div class="player-container">
    <div class="vinyl-player">
        <div class="outer-glow"></div>
        
        <div class="vinyl-disc" id="vinylDisc">
            <div class="cover-container">
                <div class="neon-glow"></div>
                <img class="cover-art" id="cover" src="https://picsum.photos/300" alt="Cover">
                <div class="center-hole"></div>
            </div>
        </div>

        <div class="tone-arm" id="toneArm">
            <div class="tone-arm-base"></div>
            <div class="tone-arm-bar"></div>
            <div class="tone-arm-head"></div>
            <div class="tone-arm-needle"></div>
        </div>
    </div>

    <div class="station-info">
        <h1 class="station-name">KIARA 4U</h1>
        
        <div class="now-playing">
            <span class="now-playing-label">Now Playing</span>
            <div class="equalizer" id="equalizer">
                <div class="eq-bar"></div>
                <div class="eq-bar"></div>
                <div class="eq-bar"></div>
                <div class="eq-bar"></div>
                <div class="eq-bar"></div>
            </div>
        </div>
        
        <div class="song-info">
            <div class="song-title" id="title">KIARA 4U</div>
            <div class="song-artist" id="artist">Streaming Live</div>
        </div>

        <div class="controls">
            <div class="volume-control">
                <svg class="volume-icon" viewBox="0 0 24 24">
                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
                </svg>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
            </div>

            <button class="play-btn" id="playBtn">
                <svg class="play-icon" viewBox="0 0 24 24">
                    <path d="M8 5v14l11-7z"/>
                </svg>
                <svg class="pause-icon" viewBox="0 0 24 24">
                    <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                </svg>
            </button>

            <div class="volume-control" style="visibility: hidden;">
                <input type="range" class="volume-slider" min="0" max="100" value="80">
            </div>
        </div>

        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">Ready to play</span>
        </div>
    </div>
</div>

<div class="credit">Vinyl Player by Juneid</div>

<audio id="audio" preload="none"></audio>

<script>
// ==================== CONFIG ====================
const streamURL = "https://eu1.fastcast4u.com/proxy/kiarafm?mp=/1";
// Menggunakan URL cover yang lebih netral sebagai fallback
const fallbackCover = "https://picsum.photos/300"; 

// ==================== ELEMENTS ====================
const audio = document.getElementById("audio");
const playBtn = document.getElementById("playBtn");
const vinylDisc = document.getElementById("vinylDisc");
const toneArm = document.getElementById("toneArm");
const equalizer = document.getElementById("equalizer");
const volumeSlider = document.getElementById("volumeSlider");
const statusDot = document.getElementById("statusDot");
const statusText = document.getElementById("statusText");
const cover = document.getElementById("cover");
const titleEl = document.getElementById("title");
const artistEl = document.getElementById("artist");

// ==================== COLORS ====================
const colors = [
    'linear-gradient(135deg, #667eea, #764ba2)',
    'linear-gradient(135deg, #f093fb, #f5576c)',
    'linear-gradient(135deg, #4facfe, #00f2fe)',
    'linear-gradient(135deg, #fa709a, #fee140)',
    'linear-gradient(135deg, #30cfd0, #330867)',
    'linear-gradient(135deg, #a8edea, #fed6e3)',
    'linear-gradient(135deg, #ff9a9e, #fecfef)',
    'linear-gradient(135deg, #00c6fb, #005bea)'
];

const neonColors = ['#ff00ff', '#00ffff', '#ff6b6b', '#ffd700', '#00ff88', '#ff69b4', '#a855f7', '#00d4ff'];

// ==================== STATE ====================
audio.src = streamURL;
audio.volume = volumeSlider.value / 100;

let isPlaying = false;
let lastTrack = "";
let colorIndex = 0;

// ==================== PARTICLES ====================
function createParticles() {
    const container = document.getElementById('particles');
    for (let i = 0; i < 20; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        p.style.left = Math.random() * 100 + '%';
        p.style.width = (2 + Math.random() * 4) + 'px';
        p.style.height = p.style.width;
        p.style.animationDelay = Math.random() * 15 + 's';
        p.style.animationDuration = (12 + Math.random() * 10) + 's';
        container.appendChild(p);
    }
}

// ==================== BACKGROUND ====================
function changeBG(seed) {
    const x = Math.abs(seed.split('').reduce((a, c) => a + c.charCodeAt(0), 0));
    const idx = x % colors.length;
    document.body.style.background = colors[idx];
    document.documentElement.style.setProperty('--neon-color', neonColors[idx]);
}

function cycleBG() {
    colorIndex = (colorIndex + 1) % colors.length;
    document.body.style.background = colors[colorIndex];
    document.documentElement.style.setProperty('--neon-color', neonColors[colorIndex]);
}

// ==================== COVER ART ====================
async function getDeezerCover(artist, title) {
    try {
        const q = `artist:"${artist}" track:"${title}"`;
        const url = "https://api.deezer.com/search?q=" + encodeURIComponent(q);
        const r = await fetch(url);
        const j = await r.json();
        if (j.data && j.data.length > 0) {
            const alb = j.data[0].album || {};
            return alb.cover_xl || alb.cover_big || alb.cover_medium || null;
        }
    } catch (e) {}
    return null;
}

async function getItunesCover(artist, title) {
    try {
        const url = `https://itunes.apple.com/search?term=${encodeURIComponent(artist + " " + title)}&limit=1`;
        const r = await fetch(url);
        const data = await r.json();
        if (data.results && data.results.length > 0) {
            return data.results[0].artworkUrl100.replace("100x100", "600x600");
        }
    } catch (e) {}
    return null;
}

// ==================== NOW PLAYING (FIXED) ====================
async function fetchNowPlaying(forceUpdate = false) {
    const raw = document.getElementById("fcast").innerText.trim();
    if (!raw) return;

    let artist = "Unknown Artist";
    let title = raw;
    let img = null;

    // --- 1. Logika Pemisahan String yang Robust ---
    if (raw.includes(" - ")) {
        const p = raw.split(" - ");
        // Ambil elemen pertama sebagai Artis
        artist = p[0].trim();
        // Gabungkan semua sisa string sebagai Judul (mengatasi Judul yang mengandung " - ")
        title = p.slice(1).join(" - ").trim();
    }
    
    // --- 2. Penanganan Konten Khusus (Jingle/Iklan/Generic) ---
    const lowerTitle = title.toLowerCase();
    const lowerArtist = artist.toLowerCase();

    if (lowerTitle === "streaming live" || lowerArtist === "unknown artist" || lowerArtist.includes("kiara 4u")) {
        // Jika statusnya "live" atau jingle stasiun, gunakan fallback cover
        img = fallbackCover;
    } else {
        // --- 3. Pencarian Cover API (Hanya jika data valid dan berbeda dari lagu sebelumnya) ---
        const trackKey = artist + " - " + title;
        if (!forceUpdate && trackKey === lastTrack) return;
        lastTrack = trackKey;
        
        // Fetch cover: Deezer first, then iTunes
        img = await getDeezerCover(artist, title);
        if (!img) {
            img = await getItunesCover(artist, title);
        }
    }
    
    // Jika masih null setelah pencarian, gunakan fallback.
    img = img || fallbackCover;

    // --- 4. Update Tampilan ---
    // Fade out
    cover.style.opacity = '0';
    titleEl.classList.remove('fade-in');
    artistEl.classList.remove('fade-in');

    setTimeout(() => {
        // Update content
        cover.src = img;
        titleEl.textContent = title;
        artistEl.textContent = artist;

        // Fade in
        cover.style.opacity = '1';
        titleEl.classList.add('fade-in');
        artistEl.classList.add('fade-in');

        // Change background
        changeBG(title + artist);
    }, 400);
}

// ==================== PLAYER CONTROLS ====================
function startPlaying() {
    isPlaying = true;
    playBtn.classList.add('playing');
    vinylDisc.classList.add('spinning');
    toneArm.classList.add('playing');
    equalizer.classList.add('active');
    statusDot.classList.remove('buffering');
    statusDot.classList.add('live');
    statusText.textContent = 'Live â€¢ On Air';
}

function stopPlaying() {
    isPlaying = false;
    playBtn.classList.remove('playing');
    vinylDisc.classList.remove('spinning');
    toneArm.classList.remove('playing');
    equalizer.classList.remove('active');
    statusDot.classList.remove('live', 'buffering');
    statusText.textContent = 'Paused';
}

// ==================== EVENT LISTENERS ====================
playBtn.onclick = () => {
    if (isPlaying) {
        audio.pause();
    } else {
        statusDot.classList.add('buffering');
        statusText.textContent = 'Connecting...';
        audio.play().catch(() => {
            statusText.textContent = 'Tap to retry';
            statusDot.classList.remove('buffering');
        });
    }
};

volumeSlider.oninput = (e) => {
    audio.volume = e.target.value / 100;
};

audio.onplaying = startPlaying;
audio.onpause = stopPlaying;
audio.onwaiting = () => {
    statusDot.classList.add('buffering');
    statusDot.classList.remove('live');
    statusText.textContent = 'Buffering...';
};
audio.onerror = () => {
    statusText.textContent = 'Connection error';
    stopPlaying();
};

// Keyboard
document.onkeydown = (e) => {
    if (e.code === 'Space') {
        e.preventDefault();
        playBtn.click();
    }
};

// ==================== INIT ====================
createParticles();
changeBG('KIARA4U');

// Auto cycle background every 15 seconds
setInterval(cycleBG, 15000);

// Fetch now playing every 4 seconds
setInterval(fetchNowPlaying, 4000);

// Initial fetch
setTimeout(() => fetchNowPlaying(true), 1000);
</script>

</body>
</html>
